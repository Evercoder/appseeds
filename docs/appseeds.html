<!DOCTYPE html>  <html> <head>   <title>appseeds.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               appseeds.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <pre><code>AppSeeds (c) 2012 Dan Burzo
AppSeeds can be freely distributed under the MIT license.
</code></pre>

<p>Elegant JavaScript components for modern web applications. Made by <a href="https://twitter.com/#!/danburzo">@danburzo</a>.</p>

<p>Fork &amp; contribute at <a href="https://github.com/danburzo/appseeds">github.com/danburzo/appseeds</a>. </p>

<p>Download <a href="https://github.com/danburzo/appseeds/zipball/master">zip</a>, <a href="https://github.com/danburzo/appseeds/tarball/master">tar</a>. </p>

<p>The guiding principles were: speed, terseness and progressive disclosure.</p>

<h1>API / Annotated source code</h1>

<p>What you're seeing below is the annotated source code slash makeshift API reference for AppSeeds.
It was automatically generated with <a href="http://jashkenas.github.com/docco/">docco</a>. Here goes:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Encapsulate the library to protect global scope.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*globals exports define require console*/</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Export AppSeeds for CommonJS and the browser.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">AppSeeds</span><span class="p">,</span> <span class="nx">Seeds</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">AppSeeds</span> <span class="o">=</span> <span class="nx">Seeds</span> <span class="o">=</span> <span class="nx">exports</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">AppSeeds</span> <span class="o">=</span> <span class="nx">Seeds</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">AppSeeds</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Seeds</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Current version of the application, using <a href="http://semver.org/">semantic versioning</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Seeds</span><span class="p">.</span><span class="nx">version</span> <span class="o">=</span> <span class="s1">&#39;0.7.0&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Polyfills, mostly for IE, around missing Array methods like <a href="https://gist.github.com/1034425">indexOf</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vArg</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">vArg</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;[object Array]&quot;</span><span class="p">;</span> <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span> 
      <span class="k">for</span><span class="p">(</span><span class="nx">c</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span><span class="nx">b</span><span class="o">=</span><span class="p">(</span><span class="nx">c</span><span class="o">+~~</span><span class="nx">b</span><span class="p">)</span><span class="o">%</span><span class="nx">c</span><span class="p">;</span><span class="nx">b</span><span class="o">&lt;</span><span class="nx">c</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">b</span> <span class="k">in</span> <span class="k">this</span><span class="p">)</span><span class="o">||</span><span class="k">this</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">!==</span><span class="nx">a</span><span class="p">);</span><span class="nx">b</span><span class="o">++</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">b</span><span class="o">^</span><span class="nx">c</span><span class="o">?</span><span class="nx">b</span><span class="o">:-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h1>Seeds.PubSub</h1>

<p>Alias: <em>Seeds.PS</em></p>

<p>Simple Publish/Subscribe implementation for the Mediator pattern.
It supports namespaced events like: <code>namespace:event</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Seeds</span><span class="p">.</span><span class="nx">PubSub</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">PS</span> <span class="o">=</span> <span class="p">{</span>
  </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Create a PubSub instance.</p>

<ul>
<li><em>options</em> a configuration object for the PubSub instance.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">ps</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">beget</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_instanceMethods</span><span class="p">);</span>
      <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="nx">ps</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">_pubsubEvents</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">_pubsubHappened</span><span class="o">:</span> <span class="p">{}</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">ps</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h3>Seeds.PubSub API</h3>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_instanceMethods</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Publish an event.</p>

<ul>
<li><strong>pub(event, [arg1, [arg2 ...]])</strong>
<ul><li><em>event</em> the event to trigger;</li>
<li><em>arg1 ... argN</em> (optional) any number of additional params to pass to the event subscribers.</li></ul></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">pub</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">eventString</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">eventComponents</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_parseEventNamespace</span><span class="p">(</span><span class="nx">eventString</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">eventArray</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">ilen</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">jlen</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">subscriber</span><span class="p">,</span> <span class="nx">ret</span><span class="p">,</span> <span class="nx">event</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ilen</span> <span class="o">=</span> <span class="nx">eventComponents</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ilen</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">eventArray</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_pubsubEvents</span><span class="p">[</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">eventComponents</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">||</span> <span class="p">[];</span>
          <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">jlen</span> <span class="o">=</span> <span class="nx">eventArray</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">jlen</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">subscriber</span> <span class="o">=</span> <span class="nx">eventArray</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">subscriber</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">subscriber</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">subscriber</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">ret</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">unsub</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">subscriber</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_pubsubHappened</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span>
      </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Parses the namespaced event string to identify its components.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_parseEventNamespace</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">ch</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">((</span><span class="nx">ch</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="o">===</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="nx">events</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
          <span class="nx">str</span> <span class="o">+=</span> <span class="nx">ch</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">events</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">events</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Subscribe a function to one or more events.</p>

<ul>
<li><strong>sub(eventString, method, [thisArg, [flags]])</strong>
<ul><li><em>eventString</em> one or more space-separated events;</li>
<li><em>method</em> the function to subscribe to the events;</li>
<li><em>thisArg</em> (optional) context for the method;</li>
<li><em>flags</em> (optional) boleans to configure the subscribers's behavior:
<ul><li><em>once</em> if true, the subscriber will self-unsubscribe after the first successful execution. You'll usually use <em>PubSub.once()</em> for this;</li>
<li><em>recoup</em> if true, the subscriber will execute immediately if the event it subscribes to already happened. You'll usually use <em>PubSub.recoup()</em> for this.</li></ul></li></ul></li>
</ul>

<p><em>Careful!</em> When subscribing a method to multiple events, if the events don't get published
with compatible parameters, you can end up with weird behavior. To avoid this, it's best to
keep a common interface for all events in the list.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">sub</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">eventStr</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="nx">flags</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="nx">eventStr</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">),</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">eventArray</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">oldArgs</span><span class="p">;</span>
        <span class="nx">flags</span> <span class="o">=</span> <span class="nx">flags</span> <span class="o">||</span> <span class="p">{</span> <span class="nx">once</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">recoup</span><span class="o">:</span> <span class="kc">false</span> <span class="p">};</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">events</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">eventArray</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_pubsubEvents</span><span class="p">[</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">events</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">eventArray</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">eventArray</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">method</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="nx">flags</span><span class="p">.</span><span class="nx">once</span><span class="p">]);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_pubsubEvents</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="nx">method</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="nx">flags</span><span class="p">.</span><span class="nx">once</span><span class="p">]];</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">flags</span><span class="p">.</span><span class="nx">recoup</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">oldArgs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_pubsubHappened</span><span class="p">[</span><span class="nx">event</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nx">method</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">thisArg</span> <span class="o">||</span> <span class="k">this</span><span class="p">,</span> <span class="nx">oldArgs</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Unsubscribe a function from one or more events.</p>

<ul>
<li><strong>unsub(eventString, method)</strong>
<ul><li><em>eventString</em> one or more space-separated events;</li>
<li><em>method</em> the function to unsubscribe</li></ul></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">unsub</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">eventStr</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="nx">eventStr</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">),</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">eventArray</span><span class="p">,</span> <span class="nx">newEventArray</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">events</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">eventArray</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_pubsubEvents</span><span class="p">[</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">events</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
          <span class="nx">newEventArray</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">eventArray</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">eventArray</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">newEventArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">eventArray</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_pubsubEvents</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newEventArray</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span>
      </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Subscribe to an event once. </p>

<p>The function will be unsubscribed upon successful exectution.
To mark the function execution as unsuccessful 
(and thus keep it subscribed), make it return <code>false</code>.</p>

<ul>
<li><strong>once(eventString, method, thisArg)</strong> identical to <em>PubSub.sub()</em>.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">once</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">eventStr</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="nx">eventStr</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="p">{</span> <span class="nx">once</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Subscribe to an event, and execute immediately if that event was ever published before.</p>

<p>If executed immediately, the subscriber will get as parameters the last values sent with the event.</p>

<ul>
<li><strong>recoup(eventString, method, thisArg)</strong> identical to <em>PubSub.sub()</em>.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">recoup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">eventStr</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="nx">eventStr</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="p">{</span> <span class="nx">recoup</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
      <span class="p">},</span>
      </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Schedule an event to publish, using <em>Seeds.Lambda</em>. </p>

<ul>
<li><strong>schedule(eventString, [arg1, ... [argN]])</strong> identical to <em>PubSub.pub()</em>.</li>
</ul>

<p>While pub() publishes an event immediately, schedule() returns a scheduled task 
which you need to trigger by using <code>now()</code>, <code>delay()</code> etc.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">schedule</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Seeds</span><span class="p">.</span><span class="nx">Lambda</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">Lambda</span><span class="p">.</span><span class="nx">create</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span>
          <span class="nx">Seeds</span><span class="p">.</span><span class="nx">Lambda</span><span class="p">,</span> 
          <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">,</span> <span class="k">this</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">))</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h4>PubSub Constants</h4>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">PUBLIC_API</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;pub&#39;</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="s1">&#39;unsub&#39;</span><span class="p">,</span> <span class="s1">&#39;once&#39;</span><span class="p">,</span> <span class="s1">&#39;recoup&#39;</span><span class="p">]</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h1>Seeds.StateManager</h1>

<p>Alias: <em>Seeds.SM</em></p>

<p><em>StateManager</em> implements a hierarchical state chart closely aligned with David Harel's definition 
from hi seminal paper <em>Statecharts: A Visual Formalism For Complex Systems</em>.</p>

<p>Using a state chart to organize your application helps your modules react to state-specific events 
in a clear, maintainable way.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Seeds</span><span class="p">.</span><span class="nx">StateManager</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">SM</span> <span class="o">=</span> <span class="p">{</span>
    </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Creates a new instance of State Manager. Used as follows:</p>

<ul>
<li><strong>create(states)</strong>
<ul><li><em>states</em> (optional) one or more space-separated state names, or an array of such strings;
convenience method for <em>StateManager.add(states)</em></li></ul></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">stateManager</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">beget</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_instanceMethods</span><span class="p">);</span>
      </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Mix in a <em>Seeds.PubSub</em> instance to use in dispatching events.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">pubsub</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">facade</span><span class="p">(</span><span class="nx">Seeds</span><span class="p">.</span><span class="nx">PS</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">PS</span><span class="p">.</span><span class="nx">PUBLIC_API</span><span class="p">,</span> <span class="nx">stateManager</span><span class="p">);</span>

      <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="nx">stateManager</span><span class="p">,</span> <span class="nx">pubsub</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">_status</span><span class="o">:</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">StateManager</span><span class="p">.</span><span class="nx">STATUS_READY</span><span class="p">,</span>
        <span class="nx">root</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
        <span class="nx">_states</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">_actions</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">_queue</span><span class="o">:</span> <span class="p">{}</span>
      <span class="p">});</span>

      <span class="nx">stateManager</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">stateManager</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">parent</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">context</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">defaultSubstate</span><span class="o">:</span> <span class="kc">null</span>
      <span class="p">});</span>
      <span class="nx">stateManager</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">stateManager</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">stateManager</span><span class="p">.</span><span class="nx">root</span><span class="p">).</span><span class="nx">context</span><span class="p">;</span>
      <span class="nx">stateManager</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">stateManager</span><span class="p">.</span><span class="nx">root</span><span class="p">;</span>
    
      <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">||</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">options</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">stateManager</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">stateManager</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h4>State Manager constants</h4>

<p>The state manager can accept a new transition.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">STATUS_READY</span><span class="o">:</span> <span class="mh">0x01</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>The state manager is currently in a transition, and therefore is locked.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">STATUS_TRANSITIONING</span><span class="o">:</span> <span class="mh">0x02</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>The state manager was paused as part of an asynchronous transition.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">STATUS_ASYNC</span><span class="o">:</span> <span class="mh">0x03</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>The flag to return in <em>enter</em>/<em>exit</em> to enter asynchronous mode and pause the state manager.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">ASYNC</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h3>Seeds.StateManager API</h3>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_instanceMethods</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Name of the root state.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">root</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
      </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Current state. This should not be manually overwritten!</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">current</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
      </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Hash for the collection of states, with state name as key and an object
as value to keep information about the state:</p>

<ul>
<li><em>parent</em> parent state</li>
<li><em>defaultSubstate</em> default substate</li>
<li><em>context</em> the collection of actions associated with the state</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_states</span><span class="o">:</span> <span class="p">{},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>The context of the current state, contains the actions and other 'private' methods
defined with when() for that state.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">context</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>The current status of the state manager.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_status</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Where we left off when going into ASYNC mode. We need this in order to resume. </p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_queue</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
      </pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Get/set information about a state.</p>

<ul>
<li><em>stateName</em> name of the state</li>
<li><em>val</em> (optional) object to set as new value for state</li>
</ul>

<p>Returns the state object.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">state</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stateName</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">_states</span><span class="p">[</span><span class="nx">stateName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_states</span><span class="p">[</span><span class="nx">stateName</span><span class="p">];</span>
      <span class="p">},</span>
      </pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Gets the substates for a state.</p>

<ul>
<li><em>stateName</em> name of the state</li>
</ul>

<p>Returns an array containing the names of the child states.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">children</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stateName</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">substates</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_states</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_states</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_states</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">parent</span> <span class="o">===</span> <span class="nx">stateName</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">substates</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">substates</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Navigates from the current state up to the root state, 
returning the list of state names that make up the branch.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_toRoot</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stateName</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">route</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">while</span><span class="p">(</span><span class="nx">stateName</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">route</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stateName</span><span class="p">);</span>
          <span class="nx">stateName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">stateName</span><span class="p">).</span><span class="nx">parent</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">route</span><span class="p">;</span>
      <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Find the LCA (Lowest Common Ancestor) between two states.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_lca</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">startState</span><span class="p">,</span> <span class="nx">endState</span><span class="p">)</span> <span class="p">{</span> 
        <span class="kd">var</span> <span class="nx">exits</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_toRoot</span><span class="p">(</span><span class="nx">startState</span><span class="p">),</span> <span class="nx">entries</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_toRoot</span><span class="p">(</span><span class="nx">endState</span><span class="p">),</span> <span class="nx">lca</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">exits</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">exits</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">lca</span> <span class="o">=</span> <span class="nx">exits</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="nx">exits</span> <span class="o">=</span> <span class="nx">exits</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
            <span class="nx">entries</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">idx</span><span class="p">).</span><span class="nx">reverse</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span> <span class="nx">exits</span><span class="o">:</span> <span class="nx">exits</span><span class="p">,</span> <span class="nx">entries</span><span class="o">:</span> <span class="nx">entries</span><span class="p">,</span> <span class="nx">lca</span><span class="o">:</span> <span class="nx">lca</span> <span class="p">};</span>
      <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Parse a state string. See <em>StateManager.add()</em> for expected formats.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_getStatePairs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">parentState</span><span class="p">,</span> <span class="nx">childStates</span><span class="p">;</span>
        <span class="k">switch</span><span class="p">(</span><span class="nx">tmp</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
            <span class="nx">childStates</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
            <span class="nx">parentState</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">;</span>
            <span class="nx">childStates</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
            <span class="nx">parentState</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s\s*/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s\s*$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span> <span class="c1">// trim</span>
            <span class="nx">childStates</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">default</span><span class="o">:</span> 
            <span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;String &#39;</span> <span class="o">+</span> <span class="nx">str</span> <span class="o">+</span> <span class="s1">&#39; is an invalid state pair and has been dropped.&#39;</span><span class="p">);</span>
            <span class="nx">childStates</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">pairs</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">childState</span><span class="p">,</span> <span class="nx">defaultSubstateRegex</span> <span class="o">=</span> <span class="sr">/^!/</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">childStates</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">childStates</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">pairs</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span>
              <span class="nx">parentState</span><span class="p">,</span> 
              <span class="nx">childStates</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="nx">defaultSubstateRegex</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> 
              <span class="nx">defaultSubstateRegex</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">childStates</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
            <span class="p">]);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">pairs</span><span class="p">;</span>
      <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Transition to a new state in the manager.</p>

<p>Attempting to transition to an inexistent state does nothing and publishes a warning.
Likewise, attempting to transition to the same state as the current one will do nothing.</p>

<p>Parameters:</p>

<ul>
<li><em>stateName</em> the name of the state to which to transition</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">go</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stateName</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">stateName</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">state</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;State &#39;</span> <span class="o">+</span> <span class="nx">stateName</span> <span class="o">+</span> <span class="s1">&#39; not defined&#39;</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">current</span> <span class="o">!==</span> <span class="nx">stateName</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_status</span> <span class="o">===</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">SM</span><span class="p">.</span><span class="nx">STATUS_READY</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">states</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_lca</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span> <span class="nx">stateName</span><span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_walk</span><span class="p">(</span><span class="nx">states</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span>

      <span class="nx">_walk</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">states</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">action</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_status</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">SM</span><span class="p">.</span><span class="nx">STATUS_TRANSITIONING</span><span class="p">;</span>

        <span class="cm">/* exit to common ancestor */</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">states</span><span class="p">.</span><span class="nx">exits</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">states</span><span class="p">.</span><span class="nx">exits</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">states</span><span class="p">.</span><span class="nx">exits</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">context</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">exit</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">exit</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="o">===</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">SM</span><span class="p">.</span><span class="nx">ASYNC</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">_status</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">SM</span><span class="p">.</span><span class="nx">STATUS_ASYNC</span><span class="p">;</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">_queue</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">exits</span><span class="o">:</span> <span class="nx">states</span><span class="p">.</span><span class="nx">exits</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nx">entries</span><span class="o">:</span> <span class="nx">states</span><span class="p">.</span><span class="nx">entries</span><span class="p">,</span> <span class="nx">lca</span><span class="o">:</span> <span class="nx">states</span><span class="p">.</span><span class="nx">lca</span> <span class="p">};</span>
              <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
        <span class="p">}</span>
      
        <span class="cm">/* set common ancestor as current state */</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">states</span><span class="p">.</span><span class="nx">lca</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">).</span><span class="nx">context</span><span class="p">;</span>

        <span class="cm">/* enter to desired state */</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">states</span><span class="p">.</span><span class="nx">entries</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">states</span><span class="p">.</span><span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">states</span><span class="p">.</span><span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">context</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">enter</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">enter</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="o">===</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">SM</span><span class="p">.</span><span class="nx">ASYNC</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">_status</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">SM</span><span class="p">.</span><span class="nx">STATUS_ASYNC</span><span class="p">;</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">_queue</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">exits</span><span class="o">:</span> <span class="p">[],</span> <span class="nx">entries</span><span class="o">:</span> <span class="nx">states</span><span class="p">.</span><span class="nx">entries</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nx">lca</span><span class="o">:</span> <span class="nx">states</span><span class="p">.</span><span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">};</span>
              <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;enter&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_status</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">SM</span><span class="p">.</span><span class="nx">STATUS_READY</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">defaultSubstate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">).</span><span class="nx">defaultSubstate</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">defaultSubstate</span><span class="p">)</span> <span class="p">{</span>
          <span class="cm">/* go to default substate */</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="nx">defaultSubstate</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="cm">/* execute &#39;stay&#39; */</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">stay</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">stay</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;stay&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="nx">resume</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_status</span> <span class="o">===</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">SM</span><span class="p">.</span><span class="nx">STATUS_ASYNC</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_walk</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_queue</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;State manager is not paused.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Add states to the manager. </p>

<p>All state names need to be unique. Attempting to add a state with an existing name 
will show a warning and the state will not be added. Likewise, attempting to add a state 
to an inexisting parent will show a warning and the state will not be added.</p>

<p>Signatures:</p>

<ul>
<li><strong>add(stateString)</strong></li>
<li><strong>add(stateString1, ..., stateStringN)</strong></li>
<li><strong>add(stateHash)</strong> where the key is the name of the parent state and the value is a list
of space-separated state names.</li>
</ul>

<p>Expected format for the state strings:</p>

<ul>
<li><code>parentState -&gt; state1 state2 state3</code> or</li>
<li><code>state1 state2 state3</code> in which case the root state is the implied parent.</li>
</ul>

<p>To specify a default substate, use <code>!</code> like this:</p>

<pre><code>parentState -&gt; state1 !state2 state3
</code></pre>

<p>TODO would be cool to add <code>=&gt;</code> instead of <code>-&gt;</code> if the substates are meant to be parallel.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stateConnection</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">parentState</span><span class="p">,</span> <span class="nx">childState</span><span class="p">,</span> <span class="nx">isDefaultSubstate</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">stateConnection</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">stateConnection</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">stateConnection</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">stateConnection</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">pairs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getStatePairs</span><span class="p">(</span><span class="nx">stateConnection</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">pairs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">parentState</span> <span class="o">=</span> <span class="nx">pairs</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
              <span class="nx">childState</span> <span class="o">=</span> <span class="nx">pairs</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
              <span class="nx">isDefaultSubstate</span> <span class="o">=</span> <span class="nx">pairs</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">parentState</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;State &#39;</span> <span class="o">+</span> <span class="nx">parentState</span> <span class="o">+</span> 
                  <span class="s1">&#39; is not included in the tree. State not added.&#39;</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">childState</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;State &#39;</span> <span class="o">+</span> <span class="nx">childState</span> <span class="o">+</span> 
                  <span class="s1">&#39; is already defined. New state not added.&#39;</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">childState</span><span class="p">,</span> <span class="p">{</span> 
                <span class="nx">context</span><span class="o">:</span> <span class="p">{},</span> 
                <span class="nx">defaultSubstate</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
                <span class="nx">parent</span><span class="o">:</span> <span class="nx">parentState</span>
              <span class="p">});</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">isDefaultSubstate</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">parentState</span><span class="p">).</span><span class="nx">defaultSubstate</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;State &#39;</span> <span class="o">+</span> <span class="nx">parentState</span> <span class="o">+</span> 
                    <span class="s1">&#39; already has a default substate &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">parentState</span><span class="p">).</span><span class="nx">defaultSubstate</span>  <span class="o">+</span> 
                    <span class="s1">&#39;. It will be overwritten with &#39;</span> <span class="o">+</span> <span class="nx">childState</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">parentState</span><span class="p">).</span><span class="nx">defaultSubstate</span> <span class="o">=</span> <span class="nx">childState</span><span class="p">;</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">stateConnection</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">stateConnection</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">stateConnection</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="s2">&quot; -&gt; &quot;</span> <span class="o">+</span> <span class="nx">stateConnection</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Perform an action within the state manager.</p>

<p>The manager will look through the entire state chain, 
starting from the current state and up to the root, for matching actions.</p>

<p>You can break this chain by returning false in one of the actions, 
to prevent it from bubbling to the ancestor states.</p>

<p>You can send any number of additional parameters to the action:</p>

<ul>
<li><strong>act(actionName, [arg1, [arg2, ..., argN]])</strong>
<ul><li><em>actionName</em> the name of the action;</li>
<li><em>arg1, ... argN</em> (optional) additional parameters to pass to the action.</li></ul></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">act</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_status</span> <span class="o">!==</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">SM</span><span class="p">.</span><span class="nx">ASYNC</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Don't forget to regenerate the context to current state 
after the recursive call ends.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_act</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;State manager is paused, can\&#39;t perform action &#39;</span> <span class="o">+</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Get a reference to a state manager action.</p>

<ul>
<li><strong>act(actionName)</strong>
<ul><li><em>actionName</em> name of the action</li></ul></li>
</ul>

<p>Returns a reference to the appropriate invocation of <em>act()</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">actionName</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_actions</span><span class="p">[</span><span class="nx">actionName</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_actions</span><span class="p">[</span><span class="nx">actionName</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">that</span><span class="p">.</span><span class="nx">act</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="p">[</span><span class="nx">actionName</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
          <span class="p">};</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_actions</span><span class="p">[</span><span class="nx">actionName</span><span class="p">];</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Act recursively up the state tree until an action returns <code>false</code>. </p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_act</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">state</span><span class="p">).</span><span class="nx">context</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">action</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">[</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">action</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">action</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;act&#39;</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">state</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">parentState</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">state</span><span class="p">).</span><span class="nx">parent</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">parentState</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">_act</span><span class="p">(</span><span class="nx">parentState</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>   
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span>    
      <span class="p">},</span>
    
      </pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Attach a set of actions for one or more states.</p>

<p>Subsequent declarations of the same action for a state will overwrite the previous ones.
Signatures:</p>

<ul>
<li><strong>when(stateNames, actionsHash)</strong>
<ul><li><em>stateNames</em> one or more space-separated stata names;</li>
<li><em>actionsHash</em> an object containing the actions to add to this state.
There are three reserved action names with special meaning:
<ul><li><em>enter</em> is executed when the manager enters the state;</li>
<li><em>exit</em> is executed when the manager leaves the state;</li>
<li><em>stay</em> is executed when the manager arrives in the state as its destination;</li></ul></li></ul></li>
<li><strong>when(stateNames, actionName, action)</strong> a simpler way to add a single action at a time to the state;</li>
<li><strong>when(stateNames, stayFunction)</strong> even simpler: if the second parameter is a function, 
it will be interpreted as the <em>stay</em> action for the state;</li>
<li><strong>when(stateHash)</strong> you can even have multiple state action declarations in the same call. </li>
</ul>

<p>For example:</p>

<pre><code> when({
   'state1 state2': { /* some actions */ },
   'state3': { /* some other actions */ } 
 });
</code></pre>

<p>Actions defined here will receive all the parameters sent with <em>StateManager.act()</em>. 
<code>this</code> inside the action refers to the state manager. <code>this.context</code> refers to the actions hash
defined for the state and can be used to reference other actions from the same state directly.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">when</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stateString</span><span class="p">,</span> <span class="nx">actions</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">stateString</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">stateString</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">stateString</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">states</span> <span class="o">=</span> <span class="nx">stateString</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">);</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">states</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">stateName</span> <span class="o">=</span> <span class="nx">states</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">stateName</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">stateName</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;State &#39;</span> <span class="o">+</span> <span class="nx">stateName</span> <span class="o">+</span> <span class="s1">&#39; doesn\&#39;t exist. Actions not added.&#39;</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
              <span class="p">}</span>
              
              <span class="cm">/* interpret single function as `stay` method */</span>
              <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">actions</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">stay</span><span class="o">:</span> <span class="nx">actions</span> <span class="p">};</span>
              <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">actions</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="cm">/* </span>
<span class="cm">                  interpret add(&#39;stateName&#39;, &#39;actionName&#39;, function(){ ... }) </span>
<span class="cm">                  as add(&#39;stateName&#39;, { actionName: function() {...}}) </span>
<span class="cm">                */</span>
                <span class="kd">var</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">actions</span><span class="p">;</span>
                <span class="nx">actions</span> <span class="o">=</span> <span class="p">{};</span>
                <span class="nx">actions</span><span class="p">[</span><span class="nx">tmp</span><span class="p">]</span> <span class="o">=</span> <span class="nx">action</span><span class="p">;</span>
              <span class="p">}</span>
              
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">context</span><span class="p">)</span> <span class="nx">state</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="p">{};</span>
              
              <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">actions</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">actions</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="nx">state</span><span class="p">.</span><span class="nx">context</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">actions</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <h1>Seeds.Lambda</h1>

<p><em>Lambda</em> supercharges your functions, providing a clear API for delaying, repeating, and limiting their execution.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Seeds</span><span class="p">.</span><span class="nx">Lambda</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Create a task.</p>

<ul>
<li><strong>create(callback, thisArg, [arg1, [arg2 ... ])</strong>
<ul><li><em>callback</em> the function to schedule;</li>
<li><em>thisArg</em> (optional) context for the function;</li>
<li><em>arg1 ... argN</em> (optional) additional parameters to send to the function.</li></ul></li>
</ul>

<p>Returns a <em>StateManager.Lambda</em> task. Can also be invoked as <em>Seeds.f()</em>, for convenience.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">reset</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_instanceMethods</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="o">:</span> <span class="nx">callback</span><span class="p">,</span>
        <span class="nx">args</span><span class="o">:</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="nx">thisArg</span><span class="o">:</span> <span class="nx">thisArg</span> <span class="o">||</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">limit</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">_lastCalled</span><span class="o">:</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">(),</span>
        <span class="nx">_timerId</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">period</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">type</span><span class="o">:</span> <span class="kc">null</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <h3>Seeds.Lambda API</h3>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_instanceMethods</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Execute the task immediately. If the task is throttled (see <em>Lambda.throttle()</em>),
it will not be executed with higher frequency than the one imposed by the throttle limit. </p>

<p>If you provide parameters to this call, they will override the ones declared on <em>create()</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">run</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">limit</span> <span class="o">||</span> <span class="p">(</span><span class="nx">now</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_lastCalled</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">limit</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">thisArg</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">arguments</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">args</span><span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_lastCalled</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Stop the scheduled task.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">stop</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_timerId</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;delay&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_timerId</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;interval&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_timerId</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Reset the timer of the schedule task, effectively postponing its execution.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">reset</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">that</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span> <span class="p">};</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;delay&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_timerId</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">period</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;interval&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_timerId</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">period</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">run</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Delay task execution with a number of milliseconds.</p>

<ul>
<li><strong>delay(timeout)</strong>
<ul><li><em>timeout</em> delay of execution, in milliseconds.</li></ul></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">delay</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">timeout</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;delay&#39;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">period</span> <span class="o">=</span> <span class="nx">timeout</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Like <em>delay</em>, but also starts the timer.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">delayed</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">timeout</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="nx">timeout</span><span class="p">).</span><span class="nx">start</span><span class="p">();</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Repeat the execution of the task at a fixed interval.</p>

<ul>
<li><strong>repeat(interval)</strong>
<ul><li><em>interval</em> the execution interval</li></ul></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">repeat</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">interval</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;interval&#39;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">period</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Like <em>repeat</em>, but also starts the timer.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">repeated</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">interval</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">interval</span><span class="p">).</span><span class="nx">start</span><span class="p">();</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Limit the execution frequency of a task.</p>

<ul>
<li><strong>throttle(limit)</strong>
<ul><li><em>limit</em> the maximum frequency of execution, in milliseconds.
send <code>0</code> or <code>null</code> to cancel the throttling.</li></ul></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">throttle</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">limit</span> <span class="o">=</span> <span class="nx">limit</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
  </pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <h1>Seeds.Permit</h1>

<p>Conditionally allow the execution of functions in your application.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Seeds</span><span class="p">.</span><span class="nx">Permit</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Create an instance of <em>Seeds.Permit</em>.</p>

<ul>
<li><strong>create([evaluator, [thisArg]])</strong> convenience method to create a new <em>Permit</em> instance 
and define the evaluator directly. Signature is identical to <em>Permit.evaluator</em>.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evalFunc</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">)</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">permit</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">beget</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_instanceMethods</span><span class="p">);</span>
      </pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Mix in a <em>Seeds.PubSub</em> instance to use in dispatching events.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">pubsub</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">facade</span><span class="p">(</span><span class="nx">Seeds</span><span class="p">.</span><span class="nx">PS</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">PS</span><span class="p">.</span><span class="nx">PUBLIC_API</span><span class="p">,</span> <span class="nx">permit</span><span class="p">);</span>

      <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="nx">permit</span><span class="p">,</span> <span class="nx">pubsub</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">_functions</span><span class="o">:</span> <span class="p">{},</span> 
        <span class="nx">_evaluator</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">expr</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">expr</span><span class="p">;</span> <span class="p">},</span> 
        <span class="nx">_thisArg</span><span class="o">:</span> <span class="k">this</span>
      <span class="p">});</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">evalFunc</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">permit</span><span class="p">.</span><span class="nx">evaluator</span><span class="p">(</span><span class="nx">evalFunc</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="k">return</span> <span class="nx">permit</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <h3>Seeds.Permit API</h3>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_instanceMethods</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>This method matches the expression to the evaluator, to decide whether to allow the execution of the function.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_isAllowed</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">expr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">_evaluator</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">expr</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">_evaluator</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">_evaluator</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_evaluator</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_thisArg</span><span class="p">,</span> <span class="nx">expr</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_evaluator</span> <span class="k">instanceof</span> <span class="nb">RegExp</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_evaluator</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">expr</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Allow a function for a set of user roles.</p>

<ul>
<li><strong>allow(expr, originalFunction)</strong>
<ul><li><em>expr</em> expression to evaluate</li>
<li><em>originalFunction</em> the function to protect</li></ul></li>
</ul>

<p>Returns a protected version of the function, 
which can only be executed when the provided expression makes the evaluator return a truthy value (see <em>Permit.evaluator</em>).</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">allow</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="nx">originalFunction</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">fId</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">originalFunction</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_functions</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_functions</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_functions</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">func</span> <span class="o">===</span> <span class="nx">originalFunction</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">fId</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span> 
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fId</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_functions</span><span class="p">[</span><span class="nx">fId</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">guid</span><span class="p">()]</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">func</span><span class="o">:</span> <span class="nx">originalFunction</span><span class="p">,</span> <span class="nx">expr</span><span class="o">:</span> <span class="nx">expr</span> <span class="p">};</span>
          <span class="p">}</span>
          <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_functions</span><span class="p">[</span><span class="nx">fId</span><span class="p">],</span> <span class="nx">permit</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
          <span class="nx">f</span><span class="p">.</span><span class="nx">locked</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">permit</span><span class="p">.</span><span class="nx">_isAllowed</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">expr</span><span class="p">))</span> <span class="p">{</span>
              <span class="cm">/* allow */</span>
              <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
              <span class="nx">permit</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;allow&#39;</span><span class="p">,</span> <span class="nx">f</span><span class="p">.</span><span class="nx">locked</span><span class="p">,</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
              <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="cm">/* disallow */</span>
              <span class="nx">permit</span><span class="p">.</span><span class="nx">pub</span><span class="p">(</span><span class="s1">&#39;disallow&#39;</span><span class="p">,</span> <span class="nx">f</span><span class="p">.</span><span class="nx">locked</span><span class="p">,</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
            <span class="p">}</span>
          <span class="p">};</span>
          <span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">locked</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">},</span>
      </pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Set the evaluator for the permit.</p>

<ul>
<li><strong>evaluator(ev, [thisArg])</strong>
<ul><li><em>ev</em> the evaluator; can be a function, string or regular expression;</li>
<li><em>thisArg</em> (optional) if the evaluator is a function, you can also send a context for it.</li></ul></li>
</ul>

<p>When the evaluator is a function, it will receive a single parameter: the expression to evaluate.
Return a truthy value if the expression passes and a falsy value otherwise.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">evaluator</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_evaluator</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">thisArg</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">_thisArg</span> <span class="o">=</span> <span class="nx">thisArg</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <h1>Utility methods</h1>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <h2>Seeds.o</h2>

<p><em>Seeds.o</em> implements useful methods for object manipulation.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p><em>guid</em> generates random GUIDs (Global Unique IDs) for things.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">guid</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">S4</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(((</span><span class="mi">1</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">())</span><span class="o">*</span><span class="mh">0x10000</span><span class="p">)</span><span class="o">|</span><span class="mi">0</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="p">};</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">S4</span><span class="p">()</span><span class="o">+</span><span class="nx">S4</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="nx">S4</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="nx">S4</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="nx">S4</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="nx">S4</span><span class="p">()</span><span class="o">+</span><span class="nx">S4</span><span class="p">()</span><span class="o">+</span><span class="nx">S4</span><span class="p">());</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p><em>mixin</em> takes an arbitrary number of objects as arguments and mixes them into the first object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">mixin</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ext</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ext</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">ext</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ext</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">j</span><span class="p">))</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ext</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p><em>beget</em> implements prototypal inheritance, as suggested in
<a href="http://javascript.crockford.com/prototypal.html">this article</a> by Douglas Crockford.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">beget</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">C</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
      <span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p><em>facade</em> returns a facade for a source object containing the desired subset of methods.</p>

<ul>
<li><strong>facade(sourceObj, api, destObj)</strong>
<ul><li><em>sourceObj</em> the source object containing the methods;</li>
<li><em>api</em> a mapping for the methods to include in the facade:
<ul><li>if it's an array, the facade method names will have the same name 
as the ones in the source object;</li>
<li>if it's a hash, the key will be the method name from the source object
and the value will be the name to use in the facade;</li></ul></li>
<li><em>destObj</em> (optional) the destination object to which to bind the methods;
if ommited, the methods will be re-bound to the facade itself.</li></ul></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">facade</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sourceObj</span><span class="p">,</span> <span class="nx">api</span><span class="p">,</span> <span class="nx">destObj</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">facade</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">i</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">api</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">api</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">facade</span><span class="p">[</span><span class="nx">api</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">sourceObj</span><span class="p">,</span> <span class="nx">api</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">destObj</span> <span class="o">||</span> <span class="nx">facade</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">api</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">api</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">api</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">facade</span><span class="p">[</span><span class="nx">api</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">sourceObj</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">destObj</span> <span class="o">||</span> <span class="nx">facade</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">facade</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p><em>bind</em> implements functionality similar to <em>Function.bind</em>
in that it attaches a method to a different context.</p>

<ul>
<li><strong>bind(sourceObj, methodName, destObj)</strong>
<ul><li><em>sourceObj</em> the original object where the method was defined;</li>
<li><em>methodName</em> the name of the property to bind;</li>
<li><em>destObj</em> destination object to which to bind the function.</li></ul></li>
</ul>

<p>In addition to the usual bind behavior, <em>bind</em> detects method chaining
and keeps it intact with the new context.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">bind</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sourceObj</span><span class="p">,</span> <span class="nx">methodName</span><span class="p">,</span> <span class="nx">destObj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">sourceObj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">sourceObj</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="cm">/* detect method chaining */</span>
        <span class="k">return</span> <span class="nx">ret</span> <span class="o">===</span> <span class="nx">sourceObj</span> <span class="o">?</span> <span class="nx">destObj</span> <span class="o">:</span> <span class="nx">ret</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <h2>Seeds.f</h2>

<p>Use this as an alias for <em>Seeds.Lambda.create</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Seeds</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Seeds</span><span class="p">.</span><span class="nx">Lambda</span><span class="p">.</span><span class="nx">create</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Seeds</span><span class="p">.</span><span class="nx">Lambda</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">})(</span><span class="k">this</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 