Backbone.StateRouter=Backbone.Router.extend({constructor:function(a){Backbone.Router.prototype.constructor.call(this,a),this.manager=a.manager;if(this.manager){var b=this;this.manager.sub("stay",function(a){var c=b._stateRoutes[a],d=Array.prototype.slice.call(arguments,1),e,f;if(c){e=b._routeToRegExp(c),f=e.exec(c).slice(1);if(f.length>=1&&d.length>=1)for(var g=0;g<f.length;g++)c=c.replace(f[g],d[g]);b.navigate(c)}}),this.on("all",function(a){var b=/^route:state:(.+)/.exec(a),c=Array.prototype.slice.call(arguments,1)||[];b&&(c.unshift(b[1]),this.manager.go.apply(this.manager,c))})}},route:function(a,b){Backbone.Router.prototype.route.apply(this,arguments);var c=/^state:(.+)/.exec(b);this._stateRoutes||(this._stateRoutes={}),c&&(this._stateRoutes[c[1]]=a)}});